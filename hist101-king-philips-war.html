<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>King Philip's War Investigation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a2332 0%, #2d4059 100%);
            color: #2c1810;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #8b1a1a 0%, #5c1010 100%);
            color: #f4e4c1;
            padding: 40px 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            border: 3px solid #d4af37;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            color: #f4e4c1;
        }

        .subtitle {
            font-size: 1.2em;
            font-style: italic;
            color: #d4af37;
        }

        .central-question {
            background: #e8dcc4;
            border-left: 5px solid #8b1a1a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 1.3em;
            text-align: center;
            font-weight: bold;
            color: #2c1810;
        }

        .progress-indicator {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            padding: 20px;
            background: #e8dcc4;
            border-radius: 8px;
            border: 3px solid #8b1a1a;
        }

        .progress-step {
            text-align: center;
            flex: 1;
            padding: 10px;
            opacity: 0.5;
            transition: all 0.3s;
            color: #2c1810;
        }

        .progress-step.completed {
            opacity: 1;
            color: #1a5c10;
            font-weight: bold;
        }

        .progress-step.active {
            opacity: 1;
            color: #8b1a1a;
            font-weight: bold;
            transform: scale(1.1);
        }

        .phase-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .phase-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .timeline {
            background: #e8dcc4;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .timeline-item {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #fff;
            border-left: 4px solid #2d4059;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .timeline-item.highlight {
            border-left-color: #8b1a1a;
            border-left-width: 5px;
            background: rgba(139, 26, 26, 0.1);
        }

        .timeline-year {
            color: #8b1a1a;
            font-weight: bold;
            min-width: 80px;
            font-size: 1.1em;
        }

        .timeline-event {
            flex: 1;
        }

        .info-box {
            background: #e8dcc4;
            padding: 25px;
            border-left: 5px solid #2d4059;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .info-box h4 {
            color: #2d4059;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .document-section {
            background: #e8dcc4;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .document-header {
            background: linear-gradient(135deg, #2d4059 0%, #1a2332 100%);
            color: #f4e4c1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid #d4af37;
        }

        .document-header h3 {
            color: #d4af37;
            font-size: 1.6em;
            margin-bottom: 10px;
        }

        .document-header p {
            color: #f4e4c1;
            font-style: italic;
        }

        .document-text {
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #2d4059;
            margin: 20px 0;
            font-size: 1.05em;
            line-height: 1.8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .document-text p {
            margin-bottom: 20px;
        }

        .document-source {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
        }

        .question-section {
            background: #f5ede0;
            border: 2px solid #2d4059;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-section h4 {
            color: #2d4059;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .question {
            margin: 25px 0;
        }

        .question label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #2c1810;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #fff;
            border: 2px solid #2d4059;
            border-radius: 5px;
            color: #2c1810;
            font-family: 'Georgia', serif;
            font-size: 1em;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #d4af37;
            background: #fffef8;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
            font-family: 'Georgia', serif;
        }

        .btn-primary {
            background: #8b1a1a;
            color: #f4e4c1;
            border: 2px solid #d4af37;
        }

        .btn-primary:hover:not(:disabled) {
            background: #6d1515;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        .btn:disabled {
            background: #999;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .hypothesis-section {
            background: #e8dcc4;
            border: 3px solid #8b1a1a;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .hypothesis-section h2 {
            color: #8b1a1a;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .hypothesis-builder {
            background: #f5ede0;
            padding: 25px;
            border-radius: 8px;
            margin: 25px 0;
            border: 2px solid #2d4059;
        }

        .hypothesis-builder h4 {
            color: #2d4059;
            margin-bottom: 15px;
        }

        .hypothesis-item {
            margin: 25px 0;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            border-left: 4px solid #8b1a1a;
        }

        .reveal-section {
            background: #e8dcc4;
            border: 3px solid #8b1a1a;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .reveal-section h2 {
            color: #8b1a1a;
            font-size: 2em;
            margin-bottom: 20px;
            text-align: center;
        }

        .historical-outcome {
            background: rgba(139, 26, 26, 0.15);
            border: 2px solid #8b1a1a;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }

        .historical-outcome h3 {
            color: #8b1a1a;
            margin-bottom: 15px;
        }

        .navigation-buttons {
            text-align: center;
            margin: 30px 0;
        }

        .navigation-buttons .btn {
            margin: 0 10px;
        }

        .complete-check {
            color: #1a5c10;
            font-size: 1.1em;
            margin-left: 10px;
        }

        .warning-box {
            background: rgba(139, 26, 26, 0.15);
            border-left: 4px solid #8b1a1a;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box strong {
            color: #8b1a1a;
        }

        .success-banner {
            background: #1a5c10;
            color: #f4e4c1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #d4af37;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        h2 {
            color: #2d4059;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #8b1a1a;
            padding-bottom: 10px;
        }

        h3 {
            color: #2d4059;
            font-size: 1.5em;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        ul {
            margin-left: 30px;
            margin-top: 15px;
        }

        li {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .progress-indicator {
                flex-wrap: wrap;
            }

            .progress-step {
                font-size: 0.9em;
            }

            .btn {
                padding: 12px 20px;
                font-size: 1em;
            }
        }
        .breadcrumb {
            max-width: 1200px;
            margin: 0 auto 15px auto;
            padding: 10px 15px;
            font-family: 'Georgia', serif;
            font-size: 0.95em;
            color: #c0c0c0;
        }

        .breadcrumb a {
            color: #d4af37;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
            color: #f4e4c1;
        }

        .breadcrumb .separator {
            margin: 0 8px;
            color: #888;
        }

.breadcrumb .current {
            color: #f4e4c1;
        }

        /* Historical image styling */
        .historical-image {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .image-caption {
            color: #666;
            font-style: italic;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="index.html">Home</a>
        <span class="separator">‚Ä∫</span>
        <a href="activities.html">Interactive Activities</a>
        <span class="separator">‚Ä∫</span>
        <span class="current">King Philip's War Investigation</span>
    </nav>

    <div class="container">
        <header>
            <h1>üèπ King Philip's War Investigation üèπ</h1>
            <p class="subtitle">New England, 1675</p>
        </header>

        <div class="central-question">
            Central Historical Question: What caused King Philip's War?
        </div>

        <div class="progress-indicator" id="progressBar">
            <div class="progress-step active" data-phase="0">
                <div>üìö</div>
                <div>Background</div>
            </div>
            <div class="progress-step" data-phase="1">
                <div>üìú</div>
                <div>Document A</div>
            </div>
            <div class="progress-step" data-phase="2">
                <div>üìú</div>
                <div>Document B</div>
            </div>
            <div class="progress-step" data-phase="3">
                <div>üìú</div>
                <div>Document C</div>
            </div>
            <div class="progress-step" data-phase="4">
                <div>üìù</div>
                <div>Your Hypothesis</div>
            </div>
            <div class="progress-step" data-phase="5">
                <div>üîç</div>
                <div>What Happened</div>
            </div>
        </div>

        <!-- Phase 0: Background & Timeline -->
        <div class="phase-content active" id="phase0">
            <div class="info-box">
                <h2 style="color: #2d4059; text-align: center; margin-bottom: 30px; border-bottom: 3px solid #8b1a1a; padding-bottom: 10px;">Background Information</h2>
            </div>

            <div class="info-box">
                <h4>Student Information</h4>
                <label for="student-name" style="display: block; margin-top: 10px;"><strong>Your Name:</strong></label>
                <input type="text" id="student-name" placeholder="Enter your full name">
                
                <label for="section-number" style="display: block; margin-top: 10px;"><strong>Section Number:</strong></label>
                <input type="text" id="section-number" placeholder="Enter your section number (e.g., 101, 102)">
            </div>

            <div class="info-box">
                <h4>Indigenous Nations of the Region</h4>
                <p>Long before the English settled present-day New England, Algonquian peoples lived in the region. One of these Algonquian nations was the <strong>Wampanoag</strong>. Their society was built around family relations. Both men and women could serve as their leader, called a <strong>sachem</strong>, who governed their nation along with councilors, elders, and lower sachems.</p>
                <p style="margin-top: 10px;">In the early 17th century, the Wampanoag lived in present-day Rhode Island and southeastern Massachusetts. Wampanoags came into contact with European merchants at this time.</p>
            </div>

            <div class="info-box">
                <h4>English Settlers in New England</h4>
                <p>When the Pilgrims arrived in 1620, the Wampanoag taught the Pilgrims how to fish and grow crops. Epidemics from diseases brought by Europeans, land seizures by settlers, and fighting against the colonists caused the deaths of many Native Americans in New England.</p>
                <p style="margin-top: 10px;"><strong>From 1600 to 1675, the region's Native American population decreased from 140,000 to 10,000. During the same time period, the English population grew to 50,000.</strong></p>
                <p style="margin-top: 10px;">After a war between English colonists and the Pequot in 1636-1637, New England was free of major armed conflict for about forty years. In 1645, New England Puritans launched a campaign to convert the Native Americans to Christianity. About 2,000 Native Americans lived in "praying towns," where missionaries pressured them to give up their cultures and become Christians.</p>
            </div>

            <div class="timeline">
                <h3 style="color: #8b1a1a; text-align: center; margin-bottom: 30px;">Timeline of Events</h3>
                
                <div class="timeline-item">
                    <div class="timeline-year">1620</div>
                    <div class="timeline-event">Pilgrims arrive in New England. The Wampanoag teach them how to fish and grow crops.</div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-year">1636-1637</div>
                    <div class="timeline-event">War between English colonists and the Pequot.</div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-year">1645</div>
                    <div class="timeline-event">New England Puritans launch a campaign to convert Native Americans to Christianity. About 2,000 Native Americans eventually live in "praying towns."</div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-year">1600-1675</div>
                    <div class="timeline-event">Native American population decreases from 140,000 to 10,000. English population grows to 50,000.</div>
                </div>

                <div class="timeline-item highlight">
                    <div class="timeline-year">1674</div>
                    <div class="timeline-event">Winter: Sassamon, a Christian Indian who could read and write, is found dead in a pond.</div>
                </div>

                <div class="timeline-item highlight">
                    <div class="timeline-year">June 8, 1675</div>
                    <div class="timeline-event">Three Wampanoag men are executed by hanging and shooting for the murder of Sassamon.</div>
                </div>

                <div class="timeline-item highlight">
                    <div class="timeline-year">June 16, 1675</div>
                    <div class="timeline-event">John Easton meets with Metacomet (King Philip) to try to prevent war.</div>
                </div>

                <div class="timeline-item highlight">
                    <div class="timeline-year">June 24, 1675</div>
                    <div class="timeline-event"><strong>Metacomet leads an attack on Swansea, Massachusetts. King Philip's War begins.</strong></div>
                </div>
            </div>

            <div class="info-box">
    <h4>üì∑ Historical Image</h4>
    <div style="background: #fff; padding: 20px; text-align: center; border: 2px solid #2d4059; border-radius: 8px;">
        <img src="images/wampanoag-map.jpg" alt="Map of Wampanoag territory in New England" style="max-width: 100%; height: auto; border-radius: 5px;">
        <p style="color: #666; font-style: italic; margin-top: 10px; font-size: 0.9em;">Map of Wampanoag territory or early New England settlement</p>
    </div>
</div>

            <div class="info-box">
                <h4>Sachem Metacomet</h4>
                <p><strong>Metacomet</strong> (whom the English called King Philip) was the sachem of the Pokanoket, a tribe of the Wampanoag nation. In 1675, he forged a military alliance with about two-thirds of the region's Native Americans.</p>
            </div>

            <div class="info-box">
                <h4>Warm-up Questions</h4>
                <p>Based on what you've learned, answer these questions before examining the documents:</p>
                
                <div class="question">
                    <label>1. What happened to New England's Native American population in the years leading up to 1675?</label>
                    <textarea id="warmup-q1" placeholder="Your answer..."></textarea>
                </div>

                <div class="question">
                    <label>2. Based on what you learned, what do you think caused the war?</label>
                    <textarea id="warmup-q2" placeholder="Your answer..."></textarea>
                </div>
            </div>

            <div class="info-box">
                <div style="background: rgba(45, 64, 89, 0.15); border-left: 4px solid #2d4059; padding: 15px; border-radius: 5px;">
                    <strong style="color: #2d4059;">Reminder:</strong> Please complete both warm-up questions before continuing to Document A.
                </div>
            </div>

            <div class="navigation-buttons">
                <button class="btn btn-primary" onclick="startInvestigation()">Continue to Document A ‚Üí</button>
            </div>
        </div>

        <!-- Phase 1: Document A -->
        <div class="phase-content" id="phase1">
            <div class="document-section">
                <div class="document-header">
                    <h3>Document A: John Easton's Account</h3>
                    <p>John Easton, a Rhode Island official, met Metacomet on June 16, 1675, to try to prevent war between the colonists and the Native Americans. However, the negotiations failed and fighting broke out within days.</p>
                </div>

                <div class="document-text">
                    <p>In the winter in the year 1674, an Indian was found dead in a pond. The dead Indian was called Sassamon. He was a Christian who could read and write. It was said that he was a bad man and that he tried to cheat King Philip. One Indian informed the English colonists that three other Indians had murdered Sassamon, knowing that it would please the English. The three Indians were hung by colonists.</p>
                    
                    <p>It was reported that before his death Sassamon had informed the colonists of the Indian Plot to destroy the English for their wickedness. So the English were afraid and Philip was afraid and both increased their arms.</p>
                    
                    <p>About a week before war broke, we suspected it would. To try to prevent it, we sent a man to Philip, to ask if he would meet with us. King Philip agreed to come to us. He and his men said that they had done no wrong but that the English wronged them. We said we knew the English said the Indians wronged them, but our desire was to avoid fighting. The Indians acknowledged that fighting was the worst way. . . .</p>
                    
                    <p>They said when the English first came, their king's father was as a great man, and the English were as a little child; he prevented other Indians from wronging the English, and gave them corn and showed them how to plant, and let them have 100 times more land than now the king had for his own people. They believe their king's brother, when he was king, was poisoned by the colonists.</p>
                    
                    <p>Another grievance was, if 20 of their honest Indians testified that an Englishman had done them wrong, it was as nothing; and if but one of their worst Indians testified against any Indian or their king, when it pleased the English it was sufficient.</p>
                    
                    <p>Another grievance was, when their king sold land, the English would say he owed them more than they had agreed to.</p>

                    <p class="document-source">Source: John Easton, "True Relation of what I know and of Reports and My Understanding Concerning the Beginning and Progress of the War now Between the English and the Indians," 1675.</p>
                </div>

               <div style="background: #f5ede0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #2d4059;">
    <h4 style="color: #2d4059; margin-bottom: 15px;">üì∑ Historical Image</h4>
    <div style="background: #fff; padding: 20px; text-align: center; border: 2px solid #2d4059; border-radius: 8px;">
        <img src="images/john-easton.jpg" alt="John Easton or colonial meeting scene" style="max-width: 100%; height: auto; border-radius: 5px;">
        <p style="color: #666; font-style: italic; margin-top: 10px; font-size: 0.9em;">John Easton or colonial meeting scene</p>
    </div>
</div>

                <div class="question-section">
                    <h4>Document A Analysis Questions</h4>
                    
                    <div class="question">
                        <label>1. Who was John Easton?</label>
                        <input type="text" id="docA-q1" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>2. When was this account written? Was this before or after King Philip's War?</label>
                        <input type="text" id="docA-q2" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>3. How reliable is this document as an account of Metacomet's grievances?</label>
                        <textarea id="docA-q3" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>4. According to the text, what happened immediately before this meeting? How did this event lead to this meeting?</label>
                        <textarea id="docA-q4" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>5. (Close reading) According to this document, what were three grievances that Metacomet and his men made to John Easton?</label>
                        <textarea id="docA-q5" placeholder="List three grievances..." rows="4"></textarea>
                    </div>

                    <div class="question">
                        <label><strong>Hypothesis 1 ‚Äì What caused King Philip's War?</strong> (Use evidence from Document A)</label>
                        <textarea id="hypothesis1" placeholder="Your hypothesis based on Document A..." rows="4"></textarea>
                    </div>
                </div>

                <div class="warning-box" style="background: rgba(45, 64, 89, 0.15); border-left-color: #2d4059;">
                    <strong>Reminder:</strong> Please complete all Document A questions and your Hypothesis 1 before continuing to Document B.
                </div>

                <div class="navigation-buttons">
                    <button class="btn" onclick="previousPhase()">‚Üê Back to Background</button>
                    <button class="btn btn-primary" onclick="nextPhase()">Continue to Document B ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Phase 2: Document B -->
        <div class="phase-content" id="phase2">
            <div class="document-section">
                <div class="document-header">
                    <h3>Document B: Edward Randolph's Report</h3>
                    <p>The English government sent Edward Randolph to New England to investigate the causes of King Philip's War. This is an excerpt from his report to the English government.</p>
                </div>

                <div class="document-text">
                    <p>There are various opinions of the causes of the present Indian war. Some blame it to an inappropriate zeal in the magistrates of Boston to Christianize the Indians . . . and forcing on them the strict observation of colonial laws, which, to a people so rude has proven intolerable . . . and that while the magistrates, for their profit, severely enforce the laws against the Indians, the colonists, on the other side, for lucre and gain, entice and provoke the Indians to break them. . . .</p>
                    
                    <p>Some believe there have been Catholic priests who have made it their business to turn the Indians against the English. . . .</p>
                    
                    <p>Others blame the cause on some injuries against the Sachem Philip, for he possessed a tract of land called Mount Hope. . . . Some English wanted it, so they complained of injuries done by Philip and his Indians to their stock and cattle, whereupon Philip was often called before the magistrate, sometimes imprisoned, and never released without parting with a considerable part of his land.</p>
                    
                    <p>But the government of Massachusetts declares these are the sins for which God has allowed the heathen to rise against the colonists: for breaking the fifth commandment . . .; for men wearing long hair and wigs made of women's hair; for women cutting, curling and laying out their hair, and disguising themselves by following strange fashions; for the people not attending their meetings, and others leaving before the blessing is pronounced; . . . for allowing the Quakers to live among them. . . .</p>
                    
                    <p>The loss to the English in the several colonies is reckoned to amount to 150,000 pounds. . . . There having been about 1,200 houses burned, 8,000 head of cattle killed, and many thousand bushels of wheat and other grain burned . . . and upward of 3,000 Indian men, women and children destroyed, who if well managed would have been very serviceable to the English.</p>

                    <p class="document-source">Source: Edward Randolph, "The Causes and Results of King Philip's War," 1675.</p>
                </div>

                <div style="background: #f5ede0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #2d4059;">
    <h4 style="color: #2d4059; margin-bottom: 15px;">üì∑ Historical Image</h4>
    <div style="background: #fff; padding: 20px; text-align: center; border: 2px solid #2d4059; border-radius: 8px;">
        <img src="images/edward-randolph.jpg" alt="Edward Randolph or English colonial scene" style="max-width: 100%; height: auto; border-radius: 5px;">
        <p style="color: #666; font-style: italic; margin-top: 10px; font-size: 0.9em;">Edward Randolph or English colonial scene</p>
    </div>
</div>

                <div class="question-section">
                    <h4>Document B Analysis Questions</h4>
                    
                    <div class="question">
                        <label>1. Who was Edward Randolph?</label>
                        <input type="text" id="docB-q1" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>2. When was this account written? Was this before or after King Philip's War?</label>
                        <input type="text" id="docB-q2" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>3. Why might the English government have wanted to know what caused King Philip's War?</label>
                        <textarea id="docB-q3" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>4. According to this account, what did the government of Massachusetts consider to be the causes of King Philip's War?</label>
                        <textarea id="docB-q4" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>5. How reliable is this document as an account of the colonial perspective of what caused King Philip's War?</label>
                        <textarea id="docB-q5" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>6. Based on this document, how would you describe the attitude of the English towards Native Americans? Explain.</label>
                        <textarea id="docB-q6" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>7. According to this document, what were three causes of the war?</label>
                        <textarea id="docB-q7" placeholder="List three causes..." rows="4"></textarea>
                    </div>

                    <div class="question">
                        <label><strong>Hypothesis 2 ‚Äì What caused King Philip's War?</strong> (Use evidence from both Documents A and B)</label>
                        <textarea id="hypothesis2" placeholder="Your hypothesis based on Documents A and B..." rows="4"></textarea>
                    </div>
                </div>

                <div class="warning-box" style="background: rgba(45, 64, 89, 0.15); border-left-color: #2d4059;">
                    <strong>Reminder:</strong> Please complete all Document B questions and your Hypothesis 2 before continuing to Document C.
                </div>

                <div class="navigation-buttons">
                    <button class="btn" onclick="previousPhase()">‚Üê Back to Document A</button>
                    <button class="btn btn-primary" onclick="nextPhase()">Continue to Document C ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Phase 3: Document C -->
        <div class="phase-content" id="phase3">
            <div class="document-section">
                <div class="document-header">
                    <h3>Document C: William Apess's Speech</h3>
                    <p>William Apess was a Methodist minister and Pequot. He was well known in Massachusetts as a speaker, author, and activist.</p>
                    <p>He worked to gain rights for Native Americans. The following is an excerpt from one of his speeches.</p>
                </div>

                <div class="document-text">
                    <p>In 1673, the Court ruled in favor of Talmon, the young Pilgrim. Philip had to give Talmon a large tract of land at Sapamet. This angered the Chief and his people. . . .</p>
                    
                    <p>In the year 1668 Philip had made a complaint against a Pilgrim, who had wronged one of his men of a gun and some swine. There is no record that Philip got any justice. . . .</p>
                    
                    <p>The Pilgrims sent an Indian, a traitor, to preach to Philip and his men, in order to convert him and his people to Christianity. The preacher's name was Sassamon. . . . What could have been more insulting than to send a man to them who was . . . a traitor? . . . It was the laws of the Indians that such a man must die. . . .</p>
                    
                    <p>In March, 1674, one of Philip's men killed him, and placed him beneath the ice in a pond near Plymouth; doubtless by the order of Philip. . . . Tobias [was] apprehended and tried. Tobias was one of Philip's counselors. . . . In June, three Indians instead of one were arraigned. Only Tobias was previously suspected. Now two others were arraigned, tried, condemned and executed on June the 8th, 1675, by hanging and shooting. It does not appear that any more than Tobias was guilty. The other two persisted in their innocence until the end.</p>
                    
                    <p>This so exasperated King Philip, that from that day he planned his revenge on the pilgrims. He believed the executions were a violation of treaties. . . . Until the execution of these three Indians, supposed to be the murderers of Sassamon, no hostility was committed by Philip or his warriors. After the Indians were executed, he could no longer restrain his young men, who, upon the 24th of June, provoked the people of Swansea, by killing their cattle and [and causing] other injuries, which was a signal to commence the war.</p>

                    <p class="document-source">Source: "Eulogy on King Philip," delivered on January 8, 1836 at the Odeon, an auditorium in Boston, Massachusetts.</p>
                </div>

                <div style="background: #f5ede0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #2d4059;">
    <h4 style="color: #2d4059; margin-bottom: 15px;">üì∑ Historical Image</h4>
    <div style="background: #fff; padding: 20px; text-align: center; border: 2px solid #2d4059; border-radius: 8px;">
        <img src="images/william-apess.jpg" alt="William Apess or 19th century Native American advocacy" style="max-width: 100%; height: auto; border-radius: 5px;">
        <p style="color: #666; font-style: italic; margin-top: 10px; font-size: 0.9em;">William Apess or 19th century Native American advocacy</p>
    </div>
</div>

                <div class="question-section">
                    <h4>Document C Analysis Questions</h4>
                    
                    <div class="question">
                        <label>1. Who was William Apess?</label>
                        <input type="text" id="docC-q1" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>2. How many years after King Philip's War did he give this speech?</label>
                        <input type="text" id="docC-q2" placeholder="Your answer...">
                    </div>

                    <div class="question">
                        <label>3. What might have been the purpose of this speech?</label>
                        <textarea id="docC-q3" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>4. How reliable is this document as an account of the causes of King Philip's War?</label>
                        <textarea id="docC-q4" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>5. What parts of Documents A and B does this speech corroborate? What parts of Documents A and B does this speech challenge?</label>
                        <textarea id="docC-q5" placeholder="Your answer..." rows="4"></textarea>
                    </div>
                </div>

                <div class="warning-box" style="background: rgba(45, 64, 89, 0.15); border-left-color: #2d4059;">
                    <strong>Reminder:</strong> Please complete all Document C questions before continuing to your final hypothesis.
                </div>

                <div class="navigation-buttons">
                    <button class="btn" onclick="previousPhase()">‚Üê Back to Document B</button>
                    <button class="btn btn-primary" onclick="nextPhase()">Continue to Your Hypothesis ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Phase 4: Final Hypothesis -->
        <div class="phase-content" id="phase4">
            <div class="hypothesis-section">
                <h2>Your Final Hypothesis</h2>
                
                <div class="info-box">
                    <h4>Evidence You Have Examined:</h4>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>Background:</strong> Timeline of Native American-English relations 1620-1675</li>
                        <li><strong>Document A:</strong> John Easton's Account (June 16, 1675) - Metacomet's grievances</li>
                        <li><strong>Document B:</strong> Edward Randolph's Report (1675) - English government investigation</li>
                        <li><strong>Document C:</strong> William Apess's Speech (1836) - Native American perspective</li>
                    </ul>
                </div>

                <div class="hypothesis-builder">
                    <h4 style="text-align: center; font-size: 1.3em; margin-bottom: 25px;">What Caused King Philip's War?</h4>
                    
                    <div class="question">
                        <label><strong>Hypothesis 3 ‚Äì What caused King Philip's War?</strong> (Use evidence from all three documents)</label>
                        <textarea id="hypothesis3" placeholder="Write your final hypothesis using evidence from Documents A, B, and C. Be sure to explain what caused the war based on the documents you've analyzed..." rows="6"></textarea>
                    </div>

                    <div class="question">
                        <label><strong>Supporting Evidence:</strong> List at least three specific pieces of evidence from the documents that support your hypothesis.</label>
                        <textarea id="supporting-evidence" placeholder="1. Evidence from Document A:
2. Evidence from Document B:
3. Evidence from Document C:" rows="6"></textarea>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn" onclick="previousPhase()">‚Üê Back to Document C</button>
                    <button class="btn btn-primary" onclick="submitHypothesis()" id="submit-hypothesis">Submit Hypothesis</button>
                </div>
            </div>
        </div>

        <!-- Phase 5: Historical Reveal -->
        <div class="phase-content" id="phase5">
            <div class="reveal-section">
                <h2>What Really Happened?</h2>
                
                <div class="historical-outcome">
                    <h3>King Philip's War (1675-1676)</h3>
                    <p style="font-size: 1.1em; margin-top: 15px;">In June 1675, Metacomet led an attack on an English settlement in Swansea, Massachusetts. Over the next year, Native Americans attacked more than half of New England's towns and destroyed twelve out of ninety.</p>
                </div>

                <div style="background: #f5ede0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #8b1a1a;">
    <h4 style="color: #8b1a1a; margin-bottom: 15px;">üì∑ Historical Image</h4>
    <div style="background: #fff; padding: 20px; text-align: center; border: 2px solid #8b1a1a; border-radius: 8px;">
        <img src="images/king-philips-war-battle.jpg" alt="King Philip's War battle scene or aftermath" style="max-width: 100%; height: auto; border-radius: 5px;">
        <p style="color: #666; font-style: italic; margin-top: 10px; font-size: 0.9em;">King Philip's War battle scene or aftermath</p>
    </div>
</div>

                <div class="document-section">
                    <h3 style="color: #8b1a1a; margin-bottom: 20px;">The War's Devastating Impact</h3>
                    
                    <div style="margin-top: 20px; padding: 20px; background: rgba(139, 26, 26, 0.1); border-radius: 8px;">
                        <h4 style="color: #8b1a1a; margin-bottom: 10px;">Casualties and Destruction</h4>
                        <ul style="margin-left: 20px; line-height: 1.8;">
                            <li><strong>English colonists:</strong> 5% of New England's colonial population was killed</li>
                            <li><strong>Native Americans:</strong> Perhaps 40% were killed by colonists or forced to flee as a result of colonial attacks</li>
                            <li><strong>Towns destroyed:</strong> 12 out of 90 New England towns were completely destroyed</li>
                            <li><strong>Property damage:</strong> Over 1,200 houses burned, 8,000 head of cattle killed, thousands of bushels of grain destroyed</li>
                        </ul>
                    </div>

                    <div style="margin-top: 30px; padding: 20px; background: rgba(139, 26, 26, 0.1); border-radius: 8px;">
                        <h4 style="color: #8b1a1a; margin-bottom: 10px;">The End of the War</h4>
                        <p>In August 1676, colonial forces killed Metacomet, then mutilated his body and publicly displayed it. Shortly after, Native American defenses collapsed.</p>
                        <p style="margin-top: 10px;"><strong>Aftermath:</strong> Colonists sold many surviving Native American men into slavery in the West Indies and enslaved many women and children in New England. Colonists sent a smaller number of Native Americans to praying towns.</p>
                    </div>
                </div>

                <div class="timeline">
                    <h3 style="color: #8b1a1a; text-align: center; margin-bottom: 25px;">What Historians Say About the Causes</h3>
                    
                    <div class="timeline-item">
                        <div class="timeline-year">Multiple Causes</div>
                        <div class="timeline-event">Historians generally agree that King Philip's War resulted from multiple interconnected causes, not a single event.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">Land Seizures</div>
                        <div class="timeline-event">The steady loss of Native American land to English colonists created ongoing tension and economic hardship for Native communities.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">Legal Inequality</div>
                        <div class="timeline-event">Native Americans had no fair representation in colonial courts. English testimony was valued over Native American testimony.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">Cultural Conflict</div>
                        <div class="timeline-event">English attempts to convert Native Americans and force them to live in "praying towns" represented an assault on Native culture and autonomy.</div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-year">Population Collapse</div>
                        <div class="timeline-event">European diseases devastated Native populations (from 140,000 to 10,000), while English population grew to 50,000, creating a power imbalance.</div>
                    </div>

                    <div class="timeline-item highlight">
                        <div class="timeline-year">Immediate Trigger</div>
                        <div class="timeline-event">The execution of three Wampanoag men for Sassamon's murder in June 1675 was the immediate trigger that ignited decades of accumulated grievances.</div>
                    </div>
                </div>

                <div class="question-section">
                    <h4>Reflection Questions</h4>
                    
                    <div class="question">
                        <label>1. How did your hypothesis compare to what historians say about the causes of King Philip's War? What did you get right? What would you add or change?</label>
                        <textarea id="reflect-q1" placeholder="Reflect on your hypothesis..."></textarea>
                    </div>

                    <div class="question">
                        <label>2. Why is it important to examine multiple perspectives (Native American, English colonial, and English government) when studying historical events like King Philip's War?</label>
                        <textarea id="reflect-q2" placeholder="Your answer..."></textarea>
                    </div>

                    <div class="question">
                        <label>3. How do you think the different perspectives of Documents A, B, and C reflect the positions and experiences of their authors?</label>
                        <textarea id="reflect-q3" placeholder="Think about John Easton, Edward Randolph, and William Apess..."></textarea>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn btn-primary" onclick="downloadWorksheet()">üìÑ Download as PDF</button>
                    <button class="btn btn-primary" onclick="submitToSupabase()" id="submitBtn" style="background: #1a5c10;">üì§ Submit to Professor</button>
                    <button class="btn" onclick="previousPhase()">‚Üê Back to Review</button>
                </div>

                <div id="submitMessage" style="margin-top: 20px;"></div>
            </div>
        </div>

    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://bqrluqymscucvbiaaeai.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxcmx1cXltc2N1Y3ZiaWFhZWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2Njg4MTMsImV4cCI6MjA4NDI0NDgxM30.AVOjnQe_TDoWydE2wDP1_YftU1lBkYxcPuyQeZb8Nfs';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // **ASSIGNMENT CONTROL** - Set to false to close submissions
        const ASSIGNMENT_OPEN = true;  // Change to false when you want to close the assignment

        // Submission cutoff date - set to null for no deadline, or use format: 'YYYY-MM-DDTHH:MM:SS'
        // Example: '2026-03-15T23:59:59' for March 15, 2026 at 11:59 PM
        const SUBMISSION_CUTOFF = '2026-02-12T12:35:59';

        let currentPhase = 0;
        let hypothesisSubmitted = false;

        function validatePhase(phase) {
            let requiredFields = [];
            let phaseName = '';

            switch(phase) {
                case 0: // Background - warmup questions
                    requiredFields = ['warmup-q1', 'warmup-q2'];
                    phaseName = 'Warm-up Questions';
                    break;
                case 1: // Document A
                    requiredFields = ['docA-q1', 'docA-q2', 'docA-q3', 'docA-q4', 'docA-q5', 'hypothesis1'];
                    phaseName = 'Document A';
                    break;
                case 2: // Document B
                    requiredFields = ['docB-q1', 'docB-q2', 'docB-q3', 'docB-q4', 'docB-q5', 'docB-q6', 'docB-q7', 'hypothesis2'];
                    phaseName = 'Document B';
                    break;
                case 3: // Document C
                    requiredFields = ['docC-q1', 'docC-q2', 'docC-q3', 'docC-q4', 'docC-q5'];
                    phaseName = 'Document C';
                    break;
            }

            for (let fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`Please complete all questions in ${phaseName} before continuing.`);
                    field.focus();
                    return false;
                }
            }

            return true;
        }

        function startInvestigation() {
            const studentName = document.getElementById('student-name').value.trim();
            
            if (!studentName) {
                alert('Please enter your name before continuing.');
                document.getElementById('student-name').focus();
                return;
            }
            
            // Validate warmup questions
            const warmupQ1 = document.getElementById('warmup-q1').value.trim();
            const warmupQ2 = document.getElementById('warmup-q2').value.trim();
            
            if (!warmupQ1 || !warmupQ2) {
                alert('Please complete both warm-up questions before continuing to Document A.');
                if (!warmupQ1) {
                    document.getElementById('warmup-q1').focus();
                } else {
                    document.getElementById('warmup-q2').focus();
                }
                return;
            }
            
            showPhase(1);
        }

        function updateProgress(phase) {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < phase) {
                    step.classList.add('completed');
                } else if (index === phase) {
                    step.classList.add('active');
                }
            });
        }

        function showPhase(phase) {
            document.querySelectorAll('.phase-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`phase${phase}`).classList.add('active');
            
            updateProgress(phase);
            currentPhase = phase;
            window.scrollTo(0, 0);
        }

        function nextPhase() {
            if (currentPhase < 5) {
                // Validate current phase before advancing
                if (currentPhase >= 0 && currentPhase <= 3) {
                    if (!validatePhase(currentPhase)) {
                        return;
                    }
                }
                
                if (currentPhase === 4 && !hypothesisSubmitted) {
                    alert('Please submit your final hypothesis before continuing.');
                    return;
                }
                showPhase(currentPhase + 1);
            }
        }

        function previousPhase() {
            if (currentPhase > 0) {
                showPhase(currentPhase - 1);
            }
        }

        function submitHypothesis() {
            const hypothesis3 = document.getElementById('hypothesis3').value.trim();
            const evidence = document.getElementById('supporting-evidence').value.trim();

            if (!hypothesis3 || !evidence) {
                alert('Please complete both:\n\n‚Ä¢ Your final hypothesis\n‚Ä¢ Supporting evidence from the documents');
                return;
            }

            hypothesisSubmitted = true;
            updateProgress(5);
            alert('Hypothesis submitted! You can now see what really happened.');
            nextPhase();
        }

        function downloadWorksheet() {
            const studentName = document.getElementById('student-name').value.trim();
            
            if (!studentName) {
                alert('Please enter your name in the Background section.');
                showPhase(0);
                return;
            }

            if (!hypothesisSubmitted) {
                alert('Please complete your final hypothesis before downloading.');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                let y = 20;
                const lineHeight = 7;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;

                function addText(text, size = 12, isBold = false) {
                    doc.setFontSize(size);
                    if (isBold) {
                        doc.setFont(undefined, 'bold');
                    } else {
                        doc.setFont(undefined, 'normal');
                    }

                    const lines = doc.splitTextToSize(text, 170);
                    for (let i = 0; i < lines.length; i++) {
                        if (y > pageHeight - margin) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(lines[i], 20, y);
                        y += lineHeight;
                    }
                    y += 3;
                }

                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('King Philip\'s War Investigation', 20, y);
                y += 10;
                
                doc.setFontSize(12);
                doc.text('What Caused King Philip\'s War?', 20, y);
                y += 15;

                addText(`Student: ${studentName}`, 12, true);
                const sectionNumber = document.getElementById('section-number').value.trim();
                if (sectionNumber) {
                    addText(`Section: ${sectionNumber}`, 12, true);
                }
                addText(`Completed: ${new Date().toLocaleString()}`, 10);
                y += 5;

                addText('WARM-UP QUESTIONS', 14, true);
                y += 2;
                addText('1. What happened to New England\'s Native American population in the years leading up to 1675?', 11, true);
                addText(document.getElementById('warmup-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. Based on what you learned, what do you think caused the war?', 11, true);
                addText(document.getElementById('warmup-q2').value || '[Not answered]', 10);
                y += 5;

                addText('DOCUMENT A ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was John Easton?', 11, true);
                addText(document.getElementById('docA-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. When was this account written? Was this before or after King Philip\'s War?', 11, true);
                addText(document.getElementById('docA-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. How reliable is this document as an account of Metacomet\'s grievances?', 11, true);
                addText(document.getElementById('docA-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. What happened immediately before this meeting? How did this event lead to this meeting?', 11, true);
                addText(document.getElementById('docA-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. What were three grievances that Metacomet and his men made to John Easton?', 11, true);
                addText(document.getElementById('docA-q5').value || '[Not answered]', 10);
                y += 3;
                addText('Hypothesis 1:', 11, true);
                addText(document.getElementById('hypothesis1').value || '[Not provided]', 10);
                y += 5;

                addText('DOCUMENT B ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was Edward Randolph?', 11, true);
                addText(document.getElementById('docB-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. When was this account written? Was this before or after King Philip\'s War?', 11, true);
                addText(document.getElementById('docB-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. Why might the English government have wanted to know what caused King Philip\'s War?', 11, true);
                addText(document.getElementById('docB-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. What did the government of Massachusetts consider to be the causes of King Philip\'s War?', 11, true);
                addText(document.getElementById('docB-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. How reliable is this document as an account of the colonial perspective?', 11, true);
                addText(document.getElementById('docB-q5').value || '[Not answered]', 10);
                y += 3;
                addText('6. How would you describe the attitude of the English towards Native Americans?', 11, true);
                addText(document.getElementById('docB-q6').value || '[Not answered]', 10);
                y += 3;
                addText('7. What were three causes of the war according to this document?', 11, true);
                addText(document.getElementById('docB-q7').value || '[Not answered]', 10);
                y += 3;
                addText('Hypothesis 2:', 11, true);
                addText(document.getElementById('hypothesis2').value || '[Not provided]', 10);
                y += 5;

                addText('DOCUMENT C ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was William Apess?', 11, true);
                addText(document.getElementById('docC-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. How many years after King Philip\'s War did he give this speech?', 11, true);
                addText(document.getElementById('docC-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. What might have been the purpose of this speech?', 11, true);
                addText(document.getElementById('docC-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. How reliable is this document as an account of the causes of King Philip\'s War?', 11, true);
                addText(document.getElementById('docC-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. What parts of Documents A and B does this speech corroborate? What parts does it challenge?', 11, true);
                addText(document.getElementById('docC-q5').value || '[Not answered]', 10);
                y += 5;

                addText('FINAL HYPOTHESIS', 14, true);
                y += 2;
                addText('Hypothesis 3 - What caused King Philip\'s War?', 11, true);
                addText(document.getElementById('hypothesis3').value || '[Not provided]', 10);
                y += 3;
                addText('Supporting Evidence:', 11, true);
                addText(document.getElementById('supporting-evidence').value || '[Not provided]', 10);
                y += 5;

                addText('REFLECTION QUESTIONS', 14, true);
                y += 2;
                addText('1. How did your hypothesis compare to what historians say?', 11, true);
                addText(document.getElementById('reflect-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. Why is it important to examine multiple perspectives?', 11, true);
                addText(document.getElementById('reflect-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. How do the different perspectives reflect the authors\' positions?', 11, true);
                addText(document.getElementById('reflect-q3').value || '[Not answered]', 10);

                const fileName = `King_Philips_War_${studentName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);

                alert('PDF downloaded successfully!');
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('There was an error generating the PDF. Please make sure all fields are completed.');
            }
        }

       async function submitToSupabase() {
            // Check if assignment is open
            if (!ASSIGNMENT_OPEN) {
                const messageDiv = document.getElementById('submitMessage');
                messageDiv.innerHTML = '<div style="background: rgba(139, 26, 26, 0.2); color: #2c1810; padding: 20px; border-radius: 8px; border-left: 5px solid #8b1a1a;">‚ùå This assignment is now closed. Submissions are no longer being accepted for full credit. You may still submit a printed assignment late within one week with 5 tickets. üéüÔ∏è Please contact your professor if you have questions.</div>';
                return;
            }

            // Check if submission deadline has passed
            if (SUBMISSION_CUTOFF) {
                const cutoffDate = new Date(SUBMISSION_CUTOFF);
                const now = new Date();
                if (now > cutoffDate) {
                    alert('‚ùå This assignment is now closed. Submissions are no longer being accepted for full credit. You may still submit a printed assignment late within one week with 5 tickets. üéüÔ∏è Please contact your professor if you have questions.');
                    return;
                }
            }

            const studentName = document.getElementById('student-name').value.trim();
            const sectionNumber = document.getElementById('section-number').value.trim();

            if (!studentName) {
                alert('Please enter your name in the Background section.');
                showPhase(0);
                return;
            }

            if (!sectionNumber) {
                alert('Please enter your section number in the Background section.');
                showPhase(0);
                document.getElementById('section-number').focus();
                return;
            }

            if (!hypothesisSubmitted) {
                alert('Please complete your final hypothesis before submitting.');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('submitMessage');

            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Submitting...';
            messageDiv.innerHTML = '<div style="background: #e8dcc4; border: 2px solid #2d4059; padding: 20px; border-radius: 8px;">Generating and uploading your PDF...</div>';

            try {
                const pdfBlob = await generatePDFBlob();

                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const sanitizedName = studentName.replace(/[^a-zA-Z0-9]/g, '_');
                const fileName = `king-philips-war/${sectionNumber}/${sanitizedName}_${timestamp}.pdf`;

                const { error: uploadError } = await supabaseClient
                    .storage
                    .from('student-submissions')
                    .upload(fileName, pdfBlob, {
                        contentType: 'application/pdf',
                        upsert: false
                    });

                if (uploadError) {
                    throw new Error(`Upload failed: ${uploadError.message}`);
                }

                const { data: urlData } = supabaseClient
                    .storage
                    .from('student-submissions')
                    .getPublicUrl(fileName);

                const formData = {
                    studentName: studentName,
                    sectionNumber: sectionNumber,
                    warmup: {
                        q1: document.getElementById('warmup-q1').value,
                        q2: document.getElementById('warmup-q2').value
                    },
                    documentA: {
                        q1: document.getElementById('docA-q1').value,
                        q2: document.getElementById('docA-q2').value,
                        q3: document.getElementById('docA-q3').value,
                        q4: document.getElementById('docA-q4').value,
                        q5: document.getElementById('docA-q5').value,
                        hypothesis1: document.getElementById('hypothesis1').value
                    },
                    documentB: {
                        q1: document.getElementById('docB-q1').value,
                        q2: document.getElementById('docB-q2').value,
                        q3: document.getElementById('docB-q3').value,
                        q4: document.getElementById('docB-q4').value,
                        q5: document.getElementById('docB-q5').value,
                        q6: document.getElementById('docB-q6').value,
                        q7: document.getElementById('docB-q7').value,
                        hypothesis2: document.getElementById('hypothesis2').value
                    },
                    documentC: {
                        q1: document.getElementById('docC-q1').value,
                        q2: document.getElementById('docC-q2').value,
                        q3: document.getElementById('docC-q3').value,
                        q4: document.getElementById('docC-q4').value,
                        q5: document.getElementById('docC-q5').value
                    },
                    finalHypothesis: {
                        hypothesis3: document.getElementById('hypothesis3').value,
                        evidence: document.getElementById('supporting-evidence').value
                    },
                    reflections: {
                        q1: document.getElementById('reflect-q1').value,
                        q2: document.getElementById('reflect-q2').value,
                        q3: document.getElementById('reflect-q3').value
                    }
                };

                await supabaseClient
                    .from('worksheet_submissions')
                    .insert({
                        student_name: studentName,
                        section_number: sectionNumber,
                        worksheet_type: 'king-philips-war',
                        file_path: fileName,
                        file_url: urlData.publicUrl,
                        form_data: formData,
                        submitted_at: new Date().toISOString()
                    });

                messageDiv.innerHTML = '<div style="background: #1a5c10; color: #f4e4c1; padding: 20px; border-radius: 8px; border-left: 5px solid #d4af37;">‚úÖ Successfully submitted! Your work has been sent to Prof. Hauselmann.</div>';
                submitBtn.textContent = '‚úì Submitted';

            } catch (error) {
                console.error('Submission error:', error);
                messageDiv.innerHTML = `<div style="background: rgba(139, 26, 26, 0.2); color: #2c1810; padding: 20px; border-radius: 8px; border-left: 5px solid #8b1a1a;">‚ùå Submission failed: ${error.message}. Please try again or download the PDF and email it to your professor.</div>`;
                submitBtn.disabled = false;
                submitBtn.textContent = 'üì§ Submit to Professor';
            }
        }

        function generatePDFBlob() {
            return new Promise((resolve) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                let y = 20;
                const lineHeight = 7;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;

                function addText(text, size = 12, isBold = false) {
                    doc.setFontSize(size);
                    if (isBold) {
                        doc.setFont(undefined, 'bold');
                    } else {
                        doc.setFont(undefined, 'normal');
                    }

                    const lines = doc.splitTextToSize(text, 170);
                    for (let i = 0; i < lines.length; i++) {
                        if (y > pageHeight - margin) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(lines[i], 20, y);
                        y += lineHeight;
                    }
                    y += 3;
                }

                const studentName = document.getElementById('student-name').value.trim();
                const sectionNumber = document.getElementById('section-number').value.trim();

                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('King Philip\'s War Investigation', 20, y);
                y += 10;
                
                doc.setFontSize(12);
                doc.text('What Caused King Philip\'s War?', 20, y);
                y += 15;

                addText(`Student: ${studentName}`, 12, true);
                if (sectionNumber) {
                    addText(`Section: ${sectionNumber}`, 12, true);
                }
                addText(`Completed: ${new Date().toLocaleString()}`, 10);
                y += 5;

                addText('WARM-UP QUESTIONS', 14, true);
                y += 2;
                addText('1. What happened to New England\'s Native American population?', 11, true);
                addText(document.getElementById('warmup-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. What do you think caused the war?', 11, true);
                addText(document.getElementById('warmup-q2').value || '[Not answered]', 10);
                y += 5;

                addText('DOCUMENT A ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was John Easton?', 11, true);
                addText(document.getElementById('docA-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. When was this account written?', 11, true);
                addText(document.getElementById('docA-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. How reliable is this document?', 11, true);
                addText(document.getElementById('docA-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. What happened immediately before this meeting?', 11, true);
                addText(document.getElementById('docA-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. What were three grievances?', 11, true);
                addText(document.getElementById('docA-q5').value || '[Not answered]', 10);
                y += 3;
                addText('Hypothesis 1:', 11, true);
                addText(document.getElementById('hypothesis1').value || '[Not provided]', 10);
                y += 5;

                addText('DOCUMENT B ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was Edward Randolph?', 11, true);
                addText(document.getElementById('docB-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. When was this account written?', 11, true);
                addText(document.getElementById('docB-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. Why did the English government want to know the causes?', 11, true);
                addText(document.getElementById('docB-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. What did Massachusetts consider to be the causes?', 11, true);
                addText(document.getElementById('docB-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. How reliable is this document?', 11, true);
                addText(document.getElementById('docB-q5').value || '[Not answered]', 10);
                y += 3;
                addText('6. English attitude towards Native Americans?', 11, true);
                addText(document.getElementById('docB-q6').value || '[Not answered]', 10);
                y += 3;
                addText('7. Three causes according to this document?', 11, true);
                addText(document.getElementById('docB-q7').value || '[Not answered]', 10);
                y += 3;
                addText('Hypothesis 2:', 11, true);
                addText(document.getElementById('hypothesis2').value || '[Not provided]', 10);
                y += 5;

                addText('DOCUMENT C ANALYSIS', 14, true);
                y += 2;
                addText('1. Who was William Apess?', 11, true);
                addText(document.getElementById('docC-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. How many years after the war?', 11, true);
                addText(document.getElementById('docC-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. Purpose of this speech?', 11, true);
                addText(document.getElementById('docC-q3').value || '[Not answered]', 10);
                y += 3;
                addText('4. How reliable is this document?', 11, true);
                addText(document.getElementById('docC-q4').value || '[Not answered]', 10);
                y += 3;
                addText('5. Corroboration with Documents A and B?', 11, true);
                addText(document.getElementById('docC-q5').value || '[Not answered]', 10);
                y += 5;

                addText('FINAL HYPOTHESIS', 14, true);
                y += 2;
                addText('Hypothesis 3:', 11, true);
                addText(document.getElementById('hypothesis3').value || '[Not provided]', 10);
                y += 3;
                addText('Supporting Evidence:', 11, true);
                addText(document.getElementById('supporting-evidence').value || '[Not provided]', 10);
                y += 5;

                addText('REFLECTIONS', 14, true);
                y += 2;
                addText('1. How did your hypothesis compare?', 11, true);
                addText(document.getElementById('reflect-q1').value || '[Not answered]', 10);
                y += 3;
                addText('2. Why examine multiple perspectives?', 11, true);
                addText(document.getElementById('reflect-q2').value || '[Not answered]', 10);
                y += 3;
                addText('3. How do perspectives reflect authors\' positions?', 11, true);
                addText(document.getElementById('reflect-q3').value || '[Not answered]', 10);

                resolve(doc.output('blob'));
            });
        }

        // Auto-save to localStorage
        setInterval(() => {
            const state = {
                studentName: document.getElementById('student-name').value,
                sectionNumber: document.getElementById('section-number').value,
                warmup: {
                    q1: document.getElementById('warmup-q1').value,
                    q2: document.getElementById('warmup-q2').value
                },
                docA: {
                    q1: document.getElementById('docA-q1').value,
                    q2: document.getElementById('docA-q2').value,
                    q3: document.getElementById('docA-q3').value,
                    q4: document.getElementById('docA-q4').value,
                    q5: document.getElementById('docA-q5').value,
                    hypothesis1: document.getElementById('hypothesis1').value
                },
                docB: {
                    q1: document.getElementById('docB-q1').value,
                    q2: document.getElementById('docB-q2').value,
                    q3: document.getElementById('docB-q3').value,
                    q4: document.getElementById('docB-q4').value,
                    q5: document.getElementById('docB-q5').value,
                    q6: document.getElementById('docB-q6').value,
                    q7: document.getElementById('docB-q7').value,
                    hypothesis2: document.getElementById('hypothesis2').value
                },
                docC: {
                    q1: document.getElementById('docC-q1').value,
                    q2: document.getElementById('docC-q2').value,
                    q3: document.getElementById('docC-q3').value,
                    q4: document.getElementById('docC-q4').value,
                    q5: document.getElementById('docC-q5').value
                },
                finalHypothesis: {
                    hypothesis3: document.getElementById('hypothesis3').value,
                    evidence: document.getElementById('supporting-evidence').value
                },
                reflections: {
                    q1: document.getElementById('reflect-q1').value,
                    q2: document.getElementById('reflect-q2').value,
                    q3: document.getElementById('reflect-q3').value
                }
            };
            localStorage.setItem('kingPhilipsWar', JSON.stringify(state));
        }, 30000);

        // Load saved state on page load
        window.onload = function() {
            const saved = localStorage.getItem('kingPhilipsWar');
            if (saved) {
                const shouldRestore = confirm('Would you like to restore your previous session?');
                if (shouldRestore) {
                    const state = JSON.parse(saved);
                    document.getElementById('student-name').value = state.studentName || '';
                    document.getElementById('section-number').value = state.sectionNumber || '';
                    document.getElementById('warmup-q1').value = state.warmup.q1 || '';
                    document.getElementById('warmup-q2').value = state.warmup.q2 || '';
                    document.getElementById('docA-q1').value = state.docA.q1 || '';
                    document.getElementById('docA-q2').value = state.docA.q2 || '';
                    document.getElementById('docA-q3').value = state.docA.q3 || '';
                    document.getElementById('docA-q4').value = state.docA.q4 || '';
                    document.getElementById('docA-q5').value = state.docA.q5 || '';
                    document.getElementById('hypothesis1').value = state.docA.hypothesis1 || '';
                    document.getElementById('docB-q1').value = state.docB.q1 || '';
                    document.getElementById('docB-q2').value = state.docB.q2 || '';
                    document.getElementById('docB-q3').value = state.docB.q3 || '';
                    document.getElementById('docB-q4').value = state.docB.q4 || '';
                    document.getElementById('docB-q5').value = state.docB.q5 || '';
                    document.getElementById('docB-q6').value = state.docB.q6 || '';
                    document.getElementById('docB-q7').value = state.docB.q7 || '';
                    document.getElementById('hypothesis2').value = state.docB.hypothesis2 || '';
                    document.getElementById('docC-q1').value = state.docC.q1 || '';
                    document.getElementById('docC-q2').value = state.docC.q2 || '';
                    document.getElementById('docC-q3').value = state.docC.q3 || '';
                    document.getElementById('docC-q4').value = state.docC.q4 || '';
                    document.getElementById('docC-q5').value = state.docC.q5 || '';
                    document.getElementById('hypothesis3').value = state.finalHypothesis.hypothesis3 || '';
                    document.getElementById('supporting-evidence').value = state.finalHypothesis.evidence || '';
                    document.getElementById('reflect-q1').value = state.reflections.q1 || '';
                    document.getElementById('reflect-q2').value = state.reflections.q2 || '';
                    document.getElementById('reflect-q3').value = state.reflections.q3 || '';
                }
            }
        };

        // Initialize
        updateProgress(0);
    </script>
</body>
</html>
