<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enlightenment Jail: Crime & Punishment Through History</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400&display=swap');
        
        :root {
            --parchment: #f4f1e8;
            --ink-dark: #1a1410;
            --ink-medium: #3d3028;
            --sepia: #8b7355;
            --rust: #a0522d;
            --gold: #d4af37;
            --prison-gray: #4a5568;
            --ancient-red: #8b1a1a;
            --enlightenment-blue: #2c5f7f;
            --shadow: rgba(0, 0, 0, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Crimson Text', serif;
            background: linear-gradient(135deg, var(--parchment) 0%, #e8dcc8 100%);
            color: var(--ink-dark);
            line-height: 1.7;
            min-height: 100vh;
        }
        
        /* Header */
        header {
            background: linear-gradient(to bottom, var(--ink-dark) 0%, var(--ink-medium) 100%);
            color: var(--parchment);
            padding: 2rem 1.5rem;
            box-shadow: 0 4px 20px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(244, 241, 232, 0.03) 2px,
                rgba(244, 241, 232, 0.03) 4px
            );
            pointer-events: none;
        }
        
        h1 {
            font-family: 'EB Garamond', serif;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 0.02em;
            position: relative;
        }
        
        .subtitle {
            text-align: center;
            font-style: italic;
            font-size: 1.1rem;
            color: var(--gold);
            position: relative;
        }
        
        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        
        /* Progress indicator */
        .progress-bar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 12px var(--shadow);
        }
        
        .phases {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }
        
        .phases::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 5%;
            right: 5%;
            height: 2px;
            background: #ddd;
            z-index: 0;
        }
        
        .phase {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .phase-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid #ddd;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #999;
            transition: all 0.3s ease;
        }
        
        .phase.active .phase-circle {
            background: var(--enlightenment-blue);
            border-color: var(--enlightenment-blue);
            color: white;
            transform: scale(1.1);
        }
        
        .phase.completed .phase-circle {
            background: var(--sepia);
            border-color: var(--sepia);
            color: white;
        }
        
        .phase-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--ink-medium);
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 16px var(--shadow);
            border-left: 4px solid var(--sepia);
        }
        
        .card h2 {
            font-family: 'EB Garamond', serif;
            font-size: 2rem;
            color: var(--ink-dark);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--parchment);
            padding-bottom: 0.5rem;
        }
        
        .card h3 {
            font-family: 'EB Garamond', serif;
            font-size: 1.5rem;
            color: var(--ink-medium);
            margin: 1.5rem 0 1rem;
        }
        
        /* Login */
        .login-container {
            max-width: 500px;
            margin: 3rem auto;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--ink-medium);
        }
        
        input[type="text"],
        input[type="email"],
        textarea,
        select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Crimson Text', serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--enlightenment-blue);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.75rem 2rem;
            background: var(--enlightenment-blue);
            color: white;
            border: none;
            border-radius: 6px;
            font-family: 'Crimson Text', serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(44, 95, 127, 0.3);
        }
        
        .btn:hover {
            background: #234d69;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 95, 127, 0.4);
        }
        
        .btn-secondary {
            background: var(--sepia);
        }
        
        .btn-secondary:hover {
            background: #6f5d47;
        }
        
        .btn-full {
            width: 100%;
        }
        
        /* Document display */
        .document-header {
            background: linear-gradient(135deg, var(--ancient-red), #6b1414);
            color: var(--parchment);
            padding: 1.5rem;
            border-radius: 8px 8px 0 0;
            margin: -2rem -2rem 0;
        }
        
        .document-header.enlightenment {
            background: linear-gradient(135deg, var(--enlightenment-blue), #1e4558);
        }
        
        .document-title {
            font-family: 'EB Garamond', serif;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .document-content {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--parchment);
            border-radius: 8px;
            border: 1px solid #d4c5a9;
        }
        
        .document-content p {
            margin-bottom: 1rem;
        }
        
        .document-content strong {
            color: var(--rust);
        }
        
        /* Prison design canvas */
        .design-area {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        
        #prisonCanvas {
            border: 2px dashed #ccc;
            border-radius: 4px;
            cursor: crosshair;
            display: block;
            margin: 1rem auto;
            background: #fafafa;
        }
        
        .drawing-tools {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .tool-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 2px solid var(--prison-gray);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tool-btn:hover,
        .tool-btn.active {
            background: var(--prison-gray);
            color: white;
        }
        
        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .gallery-item {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px var(--shadow);
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px var(--shadow);
        }
        
        .gallery-item h4 {
            font-family: 'EB Garamond', serif;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--ink-dark);
        }
        
        .gallery-item .student-name {
            font-size: 0.9rem;
            color: var(--sepia);
            margin-bottom: 1rem;
        }
        
        .gallery-canvas {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        /* Utility classes */
        .hidden {
            display: none !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid var(--enlightenment-blue);
            padding: 1rem 1.5rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }
        
        .info-box p {
            margin: 0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .phases {
                flex-direction: column;
                align-items: stretch;
            }
            
            .phases::before {
                display: none;
            }
            
            .phase {
                display: flex;
                align-items: center;
                gap: 1rem;
                text-align: left;
            }
            
            .phase-circle {
                margin: 0;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .card {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <header>
        <h1>Enlightenment Jail</h1>
        <div class="subtitle">Crime & Punishment Through History</div>
    </header>

    <div class="container">
        <!-- Admin Panel (hidden by default) -->
        <div id="adminPanel" class="hidden">
            <div class="card" style="border-left-color: var(--rust);">
                <h2>üë®‚Äçüè´ Admin Panel</h2>
                
                <div class="info-box mb-2">
                    <p><strong>Instructions:</strong> Add your students below with their ID/email and assign each one a document. Students will use their ID to log in and automatically receive their assigned reading.</p>
                </div>
                
                <div class="form-group">
                    <label>Add Student</label>
                    <div style="display: grid; grid-template-columns: 2fr 2fr 2fr 100px; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="text" id="newStudentId" placeholder="Student ID (e.g., S12345)">
                        <input type="text" id="newStudentName" placeholder="Student Name">
                        <select id="newStudentDoc">
                            <option value="">Select Document...</option>
                            <option value="hammurabi">Hammurabi's Code</option>
                            <option value="leviticus">Book of Leviticus</option>
                            <option value="foucault">Foucault - Damiens' Execution</option>
                            <option value="montesquieu">Montesquieu - Spirit of Laws</option>
                            <option value="beccaria">Beccaria - Crimes & Punishments</option>
                            <option value="bentham">Bentham - Panopticon</option>
                            <option value="howard">Howard - State of Prisons</option>
                        </select>
                        <button class="btn" onclick="addStudent()" style="padding: 0.5rem 1rem;">Add</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Or Bulk Upload (CSV format: id,name,document_id)</label>
                    <textarea id="bulkStudents" placeholder="S12345,John Smith,hammurabi&#10;S12346,Jane Doe,leviticus&#10;..." style="min-height: 100px;"></textarea>
                    <button class="btn btn-secondary" onclick="bulkUpload()" style="margin-top: 0.5rem;">Upload Bulk List</button>
                </div>
                
                <h3>Current Roster (<span id="rosterCount">0</span> students)</h3>
                <div style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 1rem; background: #fafafa;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #ddd;">
                                <th style="text-align: left; padding: 0.5rem;">Student ID</th>
                                <th style="text-align: left; padding: 0.5rem;">Name</th>
                                <th style="text-align: left; padding: 0.5rem;">Assigned Document</th>
                                <th style="text-align: center; padding: 0.5rem;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rosterTable">
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 2rem; color: #999;">No students added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                    <button class="btn btn-secondary" onclick="downloadRoster()">üì• Download Roster (CSV)</button>
                    <button class="btn btn-secondary" onclick="clearRoster()">üóëÔ∏è Clear All Students</button>
                    <button class="btn" onclick="exitAdminMode()">‚úì Done - Exit Admin Mode</button>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBar">
            <div class="phases">
                <div class="phase active" data-phase="1">
                    <div class="phase-circle">1</div>
                    <div class="phase-label">Login</div>
                </div>
                <div class="phase" data-phase="2">
                    <div class="phase-circle">2</div>
                    <div class="phase-label">Analyze</div>
                </div>
                <div class="phase" data-phase="3">
                    <div class="phase-circle">3</div>
                    <div class="phase-label">Design</div>
                </div>
                <div class="phase" data-phase="4">
                    <div class="phase-circle">4</div>
                    <div class="phase-label">Gallery</div>
                </div>
                <div class="phase" data-phase="5">
                    <div class="phase-circle">5</div>
                    <div class="phase-label">Reflect</div>
                </div>
            </div>
        </div>

        <!-- Phase 1: Login -->
        <div id="phase1" class="phase-content">
            <div class="login-container">
                <div class="card">
                    <h2>Welcome to Enlightenment Jail</h2>
                    <p class="mb-2">In this activity, you will explore how concepts of crime and punishment transformed from ancient times through the Enlightenment period.</p>
                    
                    <div class="info-box mb-2">
                        <p><strong>You will:</strong></p>
                        <p>1. Analyze one primary source document in depth</p>
                        <p>2. Design a prison based on those principles</p>
                        <p>3. View prison designs from all historical periods</p>
                        <p>4. Reflect on how ideas of justice evolved</p>
                    </div>
                    
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="studentId">Student ID</label>
                            <input type="text" id="studentId" required placeholder="Enter your Student ID (e.g., S12345)">
                            <div id="studentIdError" style="color: var(--ancient-red); margin-top: 0.5rem; display: none; font-size: 0.9rem;">
                                Student ID not found. Please check your ID or contact your instructor.
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-full">Begin Activity</button>
                    </form>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #ddd;">
                        <button class="btn btn-secondary" onclick="enterAdminMode()" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            üîë Instructor Access
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 2: Document Analysis -->
        <div id="phase2" class="phase-content hidden">
            <div class="card">
                <div id="documentHeader"></div>
                
                <div class="info-box">
                    <p><strong>Your Assignment:</strong> <span id="assignedDoc"></span></p>
                    <p>Read the document and historical context carefully, then answer the analysis questions below.</p>
                </div>
                
                <div id="documentContext"></div>
                
                <div id="documentExcerpts"></div>
                
                <h3>Document Analysis</h3>
                
                <form id="analysisForm">
                    <div class="form-group">
                        <label for="q1">1. What is the main purpose or goal of punishment according to this document?</label>
                        <textarea id="q1" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="q2">2. What types of crimes are mentioned, and what are their punishments?</label>
                        <textarea id="q2" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="q3">3. What underlying beliefs about human nature, society, or justice does this document reveal?</label>
                        <textarea id="q3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="q4">4. How does this document view the role of the state or authority in punishment?</label>
                        <textarea id="q4" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-full">Continue to Prison Design</button>
                </form>
            </div>
        </div>

        <!-- Phase 3: Prison Design -->
        <div id="phase3" class="phase-content hidden">
            <div class="card">
                <h2>Design Your Prison</h2>
                
                <div class="info-box mb-2">
                    <p>Based on <strong id="docTitle2"></strong>, design a prison (or punishment system) that reflects the principles and values you identified in your analysis.</p>
                    <p>Remember: Earlier documents may not have had "prisons" as we think of them‚Äîyour design might represent a different approach to punishment entirely.</p>
                </div>
                
                <h3>Prison Description</h3>
                
                <form id="designForm">
                    <div class="form-group">
                        <label for="prisonName">Prison Name or Title</label>
                        <input type="text" id="prisonName" required placeholder="e.g., 'The House of Reflection' or 'Court of Retribution'">
                    </div>
                    
                    <div class="form-group">
                        <label for="prisonPurpose">What is the primary purpose of your prison/punishment system?</label>
                        <textarea id="prisonPurpose" required placeholder="Explain what this prison is designed to accomplish..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="prisonStructure">Describe the physical structure or organization</label>
                        <textarea id="prisonStructure" required placeholder="What does it look like? How is it organized? What facilities does it have?"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="dailyLife">What is daily life like for those being punished?</label>
                        <textarea id="dailyLife" required placeholder="Describe their routine, treatment, activities..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="principles">How does your design reflect the principles from your document?</label>
                        <textarea id="principles" required placeholder="Connect specific features of your prison to ideas from the primary source..."></textarea>
                    </div>
                    
                    <h3>Visual Design</h3>
                    <p class="mb-1">Draw a sketch or diagram of your prison below. Use the tools to create your design.</p>
                    
                    <div class="design-area">
                        <div class="drawing-tools">
                            <button type="button" class="tool-btn active" data-tool="pen">‚úèÔ∏è Draw</button>
                            <button type="button" class="tool-btn" data-tool="erase">üßπ Erase</button>
                            <button type="button" class="tool-btn" data-tool="clear">üóëÔ∏è Clear All</button>
                            <input type="color" id="colorPicker" value="#1a1410">
                            <input type="range" id="brushSize" min="1" max="10" value="2">
                            <span>Brush Size</span>
                        </div>
                        <canvas id="prisonCanvas" width="800" height="600"></canvas>
                    </div>
                    
                    <button type="submit" class="btn btn-full" style="margin-top: 2rem;">Submit Your Design</button>
                </form>
            </div>
        </div>

        <!-- Phase 4: Gallery Walk -->
        <div id="phase4" class="phase-content hidden">
            <div class="card">
                <h2>Gallery Walk: All Prison Designs</h2>
                
                <div class="info-box mb-2">
                    <p>Explore how different historical periods approached crime and punishment. As you view each design, take notes on the key differences you observe.</p>
                </div>
                
                <div id="galleryGrid" class="gallery-grid">
                    <!-- Gallery items will be inserted here -->
                </div>
                
                <div class="text-center" style="margin-top: 2rem;">
                    <button class="btn" onclick="goToPhase(5)">Continue to Reflection</button>
                </div>
            </div>
        </div>

        <!-- Phase 5: Reflection -->
        <div id="phase5" class="phase-content hidden">
            <div class="card">
                <h2>Final Reflection</h2>
                
                <div class="info-box mb-2">
                    <p>Now that you've analyzed one document deeply and viewed all seven prison designs, reflect on how concepts of crime and punishment evolved from ancient times through the Enlightenment.</p>
                </div>
                
                <form id="reflectionForm">
                    <div class="form-group">
                        <label for="r1">1. What are the most significant differences between ancient (pre-Enlightenment) and Enlightenment approaches to punishment?</label>
                        <textarea id="r1" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="r2">2. What core principles of the Enlightenment do you see reflected in the changes to concepts of crime and punishment?</label>
                        <textarea id="r2" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="r3">3. How does the prison you designed compare to the others you viewed? What makes your approach distinctive?</label>
                        <textarea id="r3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="r4">4. Which approach to punishment do you think is most just or effective? Why? Consider both historical context and modern perspectives.</label>
                        <textarea id="r4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="r5">5. (Optional) How do you see these historical debates about punishment reflected in our modern criminal justice system?</label>
                        <textarea id="r5"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-full">Submit Reflection</button>
                </form>
            </div>
            
            <div id="completionMessage" class="card hidden">
                <h2 class="text-center">Activity Complete! üéì</h2>
                <p class="text-center mb-2">Thank you for your thoughtful work. Your responses have been submitted.</p>
                <p class="text-center">Your understanding of how Enlightenment ideas transformed concepts of justice and punishment will help inform our class discussions.</p>
            </div>
        </div>
    </div>

    <script>
        // Admin mode flag
        let isAdminMode = false;

        // Application state
        const appState = {
            currentPhase: 1,
            studentName: '',
            studentEmail: '',
            studentId: '',
            assignedDocument: null,
            analysisAnswers: {},
            prisonDesign: {},
            canvasData: null,
            reflectionAnswers: {},
            allDesigns: []
        };

        // Document assignments - rotating through all 7
        const documents = [
            {
                id: 'hammurabi',
                title: "Hammurabi's Code",
                era: 'ancient',
                context: `Hammurabi was an ancient king of Babylon, in present-day Iraq, who ruled from 1792 to 1750 BCE. He was a powerful king who expanded the reach of the Babylonian kingdom considerably northwestward up the Euphrates River. However, Hammurabi was most known for a code of over 250 laws that he set down, which were discovered in the early twentieth century when archeologists found a stone column (or "stele") upon which the laws were inscribed thousands of years earlier.

These laws were not the first of their kind; archeologists have found other, even older versions of some of these from the region. However, Hammurabi's Code became the template for countless later codes which formed the basis of law and punishment in civilizations throughout ancient Mesopotamia. There are clear connections between this and the laws mentioned in the book of Leviticus, for example, and many other places for centuries and even millennia after Hammurabi.`,
                excerpts: `The following are some of the many laws codified by Hammurabi:

<strong>Law 1:</strong> If any one ensnare another, putting a ban upon him, but he can not prove it, then he that ensnared him shall be put to death.

<strong>Law 2:</strong> If any one bring an accusation against a man, and the accused go to the river and leap into the river, if he sink in the river his accuser shall take possession of his house. But if the river prove that the accused is not guilty, and he escape unhurt, then he who had brought the accusation shall be put to death, while he who leaped into the river shall take possession of the house that had belonged to his accuser.

<strong>Law 196:</strong> If a man put out the eye of another man, his eye shall be put out. [An eye for an eye]

<strong>Law 200:</strong> If a man knock out the teeth of his equal, his teeth shall be knocked out. [A tooth for a tooth]

<strong>Law 202:</strong> If any one strike the body of a man higher in rank than he, he shall receive sixty blows with an ox-whip in public.`
            },
            {
                id: 'leviticus',
                title: "The Book of Leviticus",
                era: 'ancient',
                context: `The Book of Leviticus is the third book of the Old Testament of the Bible, called the Torah in the Jewish tradition. It follows the Book of Exodus, which describes the flight of the Hebrews from their captivity in Egypt, which led them into a desert wilderness near Mount Sinai. There, according to the Bible, Moses received the Ten Commandments from God. However, Moses also supposedly received a long list of other laws that were to dictate how the Hebrew people were to live if they wanted to maintain their covenant‚Äîor "pact"‚Äîwith God.

The Book of Leviticus does not tell a story in the same way that Genesis and Exodus do; it is mostly a list of rules and laws that the Hebrews must obey. As Christianity became the dominant religion throughout the West, it adopted certain of the laws, which became enshrined in the law of the state.`,
                excerpts: `The following are some of the laws and punishments described in Leviticus:

<strong>20:9</strong> For every one that curseth his father or his mother shall be surely put to death: he hath cursed his father or his mother; his blood shall be upon him.

<strong>20:10</strong> And the man that committeth adultery with another man's wife, even he that committeth adultery with his neighbour's wife, the adulterer and the adulteress shall surely be put to death.

<strong>24:16</strong> And he that blasphemeth the name of the LORD, he shall surely be put to death, and all the congregation shall certainly stone him.

<strong>24:19-20</strong> And if a man cause a blemish in his neighbour; as he hath done, so shall it be done to him; Breach for breach, eye for eye, tooth for tooth: as he hath caused a blemish in a man, so shall it be done to him again.`
            },
            {
                id: 'foucault',
                title: "Michel Foucault - Description of Damiens' Execution (1757)",
                era: 'pre-enlightenment',
                context: `Michel Foucault was a highly influential French historian and philosopher who published several works on the history of prisons, sexuality, and the creation of modern systems of government and social control. Foucault was particularly interested in examining how the Enlightenment created new systems to control and discipline people.

In his groundbreaking study "Discipline and Punish: The Birth of the Prison," published in 1977, Foucault demonstrated the transition from a punitive, retributive system of punishment left over from the Middle Ages to the modern "correctional" prison. He began his study with a document describing what punishment had been like just before the reforms of the Enlightenment in France‚Äîa gruesome description of a criminal being tortured to death in public in Paris in 1757.`,
                excerpts: `<strong>Execution of Damiens, March 2, 1757:</strong>

On 2 March 1757 Damiens the regicide was condemned "to make the amende honorable before the main door of the Church of Paris," where he was to be "taken and conveyed in a cart, wearing nothing but a shirt, holding a torch of burning wax weighing two pounds"; then, "in the said cart, to the Place de Gr√®ve, where, on a scaffold that will be erected there, the flesh will be torn from his breasts, arms, thighs and calves with red-hot pincers, his right hand, holding the knife with which he committed the said parricide, burnt with sulphur, and, on those places where the flesh will be torn away, poured molten lead, boiling oil, burning resin, wax and sulphur melted together and then his body drawn and quartered by four horses and his limbs and body consumed by fire, reduced to ashes and his ashes thrown to the winds."

Note that while the tortures to which Damiens is subjected are horrifying, those administering the torture are not taking pleasure in his suffering. There are priests praying for him, praying with him, and even kissing him. His suffering is seen as a necessary way of expiating‚Äîcleansing his sins in this world so that perhaps his soul might not have to suffer as much in the afterlife.`
            },
            {
                id: 'montesquieu',
                title: "Montesquieu - The Spirit of the Laws",
                era: 'enlightenment',
                context: `Charles-Louis de Secondat, Baron de Montesquieu, was a lawyer and philosopher in early-mid 18th century France whose writings had an enormous influence on the Enlightenment. Montesquieu was a pioneer in thinking about liberty, democracy, and how people could create a government that was both more free and more sustainable. He is credited with the idea of separate branches of government, ideas directly reflected in the U.S. Constitution.

Montesquieu was especially concerned with despotism‚Äîforms of government in which those in charge maintained power through fear, violence, and terror. He believed that if a ruler treats people with violent, repressive means, then the people themselves will only become more violent. If the government treats people with reason, choosing punishments proportional to crimes, then people will be more willing to respect and obey the law.`,
                excerpts: `<strong>From "The Spirit of the Laws" (1748):</strong>

The severity of punishments is fitter for despotic governments, whose principle is terror, than for a monarchy or a republic, whose spring is honour and virtue.

In moderate governments, the love of one's country, shame, and the fear of blame are restraining motives, capable of preventing a multitude of crimes. Here the greatest punishment of a bad action is conviction.

A good legislator is less bent upon punishing than preventing crimes; he is more attentive to inspire good morals than to inflict penalties.

Experience shows that in countries remarkable for the lenity of their laws the spirit of the inhabitants is as much affected by slight penalties as in other countries by severer punishments.

Liberty is in perfection when criminal laws derive each punishment from the particular nature of the crime. There are then no arbitrary decisions; the punishment does not flow from the capriciousness of the legislator, but from the very nature of the thing.`
            },
            {
                id: 'beccaria',
                title: "Cesare Beccaria - Of Crimes and Punishments",
                era: 'enlightenment',
                context: `Cesare Beccaria was an unknown son of a minor aristocratic family in Milan who was inspired by Enlightenment thinkers like Montesquieu. This inspiration led him to write "Of Crimes and Punishments," a treatise that dramatically transformed criminal justice throughout Europe. It questions why there is a death penalty at all, argues that torture is pointless and counterproductive, and strongly supports the idea that punishments should fit the crime.

Beccaria goes further in arguing that the entire point of laws and punishments is to preserve liberty, not to crush it. If a law takes away liberty as a net calculation, then that law is wrong and harmful to society. Beccaria's work was enormously influential in the West, including for "founding fathers" like John Adams.`,
                excerpts: `<strong>From "On Crimes and Punishments" (1764):</strong>

Every punishment which does not arise from absolute necessity is tyrannical. It is upon this that the sovereign's right to punish crimes is founded; that is, upon the necessity of defending the public liberty.

The intent of punishments is not to torment a sensible being, nor to undo a crime already committed. The end of punishment is no other than to prevent the criminal from doing further injury to society, and to prevent others from committing the like offence.

<strong>On Torture:</strong> No man can be judged a criminal until he be found guilty; nor can society take from him the public protection until it have been proved that he has violated the conditions on which it was granted. What right, then, but that of power, can authorize the punishment of a citizen so long as there remains any doubt of his guilt?

Crimes are more effectually prevented by the certainty than the severity of punishment. The certainty of a small punishment will make a stronger impression than the fear of one more severe, if attended with the hopes of escaping.`
            },
            {
                id: 'bentham',
                title: "Jeremy Bentham - The Panopticon",
                era: 'enlightenment',
                context: `Jeremy Bentham was one of the most influential thinkers of the Enlightenment. He is regarded as the originator of utilitarianism, which claims that the goal of laws should be "the greatest happiness for the greatest number." Rather than a place to punish or get vengeance, utilitarian thinkers said that punishments should only be chosen based on what will lead to the best outcome for society.

Similar to other Enlightenment philosophers, Bentham placed strong emphasis on education as the key to making society better. Rather than just make a criminal suffer, Bentham wanted to find ways to educate them, to make them "internalize" the law. In 1787, Bentham designed a circular prison with a guard tower in the middle and cells surrounding it. This way, a small number of guards could see prisoners at all times‚Äîor at least enough that prisoners could never shake the feeling of "being watched." He called this the "panopticon."`,
                excerpts: `<strong>From "Panopticon, or The Inspection House" (1791):</strong>

It will be found applicable to all establishments whatsoever, in which a number of persons are meant to be kept under inspection. Whether it be applied to the purposes of perpetual prisons, prisons for confinement before trial, penitentiary-houses, houses of correction, work-houses, manufactories, mad-houses, hospitals, or schools.

The essence of it consists in the centrality of the inspector's situation, combined with the well-known and most effectual contrivances for seeing without being seen.

It is important that the persons to be inspected should always feel themselves as if under inspection, at least as standing a great chance of being so.

The building is circular. The apartments of the prisoners occupy the circumference. The apartment of the inspector occupies the centre. Each cell has a window, large enough to afford light to the inspector's lodge. The inner circumference of the cell is formed by an iron grating, so light as not to screen any part of the cell from the inspector's view.

The apparent omnipresence of the inspector combined with the extreme facility of his real presence‚Äîthis plan requires fewer inspectors than ever. A greater multitude than ever were yet lodged in one house might be inspected by a single person.`
            },
            {
                id: 'howard',
                title: "John Howard - The State of Prisons",
                era: 'enlightenment',
                context: `John Howard was a prominent prison reformer in the 1700s in England. He was a Quaker and also a sheriff of Bedfordshire. He began inspecting prisons and was shocked at the terrible conditions. Prisoners were kept in extremely unsanitary conditions, were given very little food, no medical care, and many were ill from communicable diseases. When prisoners were released, they spread diseases and were often unable to be productive members of society.

In 1777 he published "The State of Prisons in England and Wales," which became widely read and influential. In it, he detailed the terrible conditions and suggested reforms guided by Enlightenment ideas and Quaker values. Prisoners should be held in sanitary conditions with good ventilation and clean water. They should each have their own cells to help them learn to feel like respected members of the human community, and to spend time in quiet reflection.`,
                excerpts: `<strong>From "The State of Prisons in England and Wales" (1777):</strong>

There are prisons, into which whoever looks will, at first sight of the people confined, be convinced, that there is some great error in the management of them: their sallow meager countenances declare, without words, that they are very miserable.

Many prisons are scantily supplied, and some almost totally destitute of the necessaries of life. Many county gaols have no water. And as to air, methods are contrived to rob prisoners of this genuine cordial of life.

The evils mentioned affect the health and life of prisoners. I have now to complain of what is pernicious to their morals; and that is, the confining of all sorts of prisoners together: debtors and felons, men and women, the young beginner and the old offender.

<strong>Reforms needed:</strong>
A prison should be built on a spot that is airy, and if possible near a river or brook. The prison should not be surrounded by other buildings; nor built in the middle of a town.

Every room should be vaulted. I wish to have so many small rooms that each criminal may sleep alone. Solitude and silence are favorable to reflection, and may possibly lead them to repentance.

Prisoners should be held in sanitary conditions, with good ventilation and clean running water. There should be a commodious bath to wash prisoners that come in dirty, and to induce them afterwards to the frequent use of it.`
            }
        ];

        // Initialize
        let assignmentCounter = parseInt(localStorage.getItem('enlightenmentJailCounter') || '0');
        
        // Canvas setup
        let canvas, ctx;
        let drawing = false;
        let currentTool = 'pen';
        let currentColor = '#1a1410';
        let brushSize = 2;

        document.addEventListener('DOMContentLoaded', function() {
            // Load saved state if exists
            const savedState = localStorage.getItem('enlightenmentJailState');
            if (savedState) {
                const confirmed = confirm('You have a saved activity in progress. Would you like to continue where you left off?');
                if (confirmed) {
                    Object.assign(appState, JSON.parse(savedState));
                    goToPhase(appState.currentPhase);
                    if (appState.studentId) {
                        document.getElementById('studentId').value = appState.studentId;
                    }
                }
            }

            setupEventListeners();
        });

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Analysis form
            document.getElementById('analysisForm').addEventListener('submit', handleAnalysis);
            
            // Design form
            document.getElementById('designForm').addEventListener('submit', handleDesign);
            
            // Reflection form
            document.getElementById('reflectionForm').addEventListener('submit', handleReflection);
        }

        function handleLogin(e) {
            e.preventDefault();
            const studentId = document.getElementById('studentId').value.trim();
            
            // Get roster from localStorage
            const roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            
            // Find student in roster
            const student = roster.find(s => s.id.toLowerCase() === studentId.toLowerCase());
            
            if (!student) {
                document.getElementById('studentIdError').style.display = 'block';
                return;
            }
            
            document.getElementById('studentIdError').style.display = 'none';
            
            // Set student info
            appState.studentId = student.id;
            appState.studentName = student.name;
            appState.studentEmail = student.id + '@yosemite.edu'; // You can customize this
            
            // Find assigned document
            appState.assignedDocument = documents.find(d => d.id === student.documentId);
            
            if (!appState.assignedDocument) {
                alert('Error: Document assignment not found. Please contact your instructor.');
                return;
            }
            
            saveState();
            goToPhase(2);
            loadDocument();
        }

        function loadDocument() {
            const doc = appState.assignedDocument;
            
            document.getElementById('assignedDoc').textContent = doc.title;
            
            const headerClass = doc.era === 'ancient' || doc.era === 'pre-enlightenment' ? '' : 'enlightenment';
            document.getElementById('documentHeader').innerHTML = `
                <div class="document-header ${headerClass}">
                    <div class="document-title">${doc.title}</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Primary Source Document ‚Ä¢ ${doc.era === 'ancient' ? 'Ancient Period' : doc.era === 'pre-enlightenment' ? 'Pre-Enlightenment' : 'Enlightenment Period'}</div>
                </div>
            `;
            
            document.getElementById('documentContext').innerHTML = `
                <div class="document-content">
                    <h3>Historical Context</h3>
                    ${doc.context.split('\n\n').map(p => `<p>${p}</p>`).join('')}
                </div>
            `;
            
            document.getElementById('documentExcerpts').innerHTML = `
                <div class="document-content">
                    <h3>Excerpts</h3>
                    ${doc.excerpts.split('\n\n').map(p => `<p>${p}</p>`).join('')}
                </div>
            `;
        }

        function handleAnalysis(e) {
            e.preventDefault();
            appState.analysisAnswers = {
                q1: document.getElementById('q1').value,
                q2: document.getElementById('q2').value,
                q3: document.getElementById('q3').value,
                q4: document.getElementById('q4').value
            };
            saveState();
            goToPhase(3);
            setupCanvas();
            document.getElementById('docTitle2').textContent = appState.assignedDocument.title;
        }

        function setupCanvas() {
            canvas = document.getElementById('prisonCanvas');
            ctx = canvas.getContext('2d');
            
            // Load saved canvas if exists
            if (appState.canvasData) {
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = appState.canvasData;
            }
            
            // Drawing tools
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tool = this.dataset.tool;
                    if (tool === 'clear') {
                        if (confirm('Clear the entire canvas?')) {
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                        }
                        return;
                    }
                    currentTool = tool;
                    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            document.getElementById('colorPicker').addEventListener('change', function() {
                currentColor = this.value;
            });
            
            document.getElementById('brushSize').addEventListener('input', function() {
                brushSize = parseInt(this.value);
            });
            
            // Canvas drawing
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch support
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            drawing = true;
            draw(e);
        }

        function draw(e) {
            if (!drawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            
            if (currentTool === 'pen') {
                ctx.strokeStyle = currentColor;
                ctx.globalCompositeOperation = 'source-over';
            } else if (currentTool === 'erase') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = brushSize * 3;
            }
            
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            drawing = false;
            ctx.beginPath();
            if (canvas) {
                appState.canvasData = canvas.toDataURL();
                saveState();
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function handleDesign(e) {
            e.preventDefault();
            appState.prisonDesign = {
                name: document.getElementById('prisonName').value,
                purpose: document.getElementById('prisonPurpose').value,
                structure: document.getElementById('prisonStructure').value,
                dailyLife: document.getElementById('dailyLife').value,
                principles: document.getElementById('principles').value,
                canvasImage: appState.canvasData
            };
            
            // Save to "database" (localStorage for demo)
            saveDesignToGallery();
            saveState();
            goToPhase(4);
            loadGallery();
        }

        function saveDesignToGallery() {
            const designs = JSON.parse(localStorage.getItem('enlightenmentJailGallery') || '[]');
            designs.push({
                studentName: appState.studentName,
                document: appState.assignedDocument,
                design: appState.prisonDesign,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('enlightenmentJailGallery', JSON.stringify(designs));
        }

        function loadGallery() {
            const designs = JSON.parse(localStorage.getItem('enlightenmentJailGallery') || '[]');
            const galleryGrid = document.getElementById('galleryGrid');
            
            if (designs.length === 0) {
                galleryGrid.innerHTML = '<p>No designs have been submitted yet. You are the first!</p>';
                return;
            }
            
            // Group by document
            const grouped = {};
            documents.forEach(doc => {
                grouped[doc.id] = designs.filter(d => d.document.id === doc.id);
            });
            
            let html = '';
            documents.forEach(doc => {
                const docDesigns = grouped[doc.id];
                if (docDesigns.length > 0) {
                    // Show one example from each document
                    const design = docDesigns[0];
                    html += `
                        <div class="gallery-item">
                            <h4>${doc.title}</h4>
                            <div class="student-name">By: ${design.studentName}</div>
                            ${design.design.canvasImage ? 
                                `<img src="${design.design.canvasImage}" class="gallery-canvas" alt="Prison design">` : 
                                '<div style="padding: 2rem; background: #f5f5f5; text-align: center; border-radius: 4px;">No drawing submitted</div>'
                            }
                            <p><strong>${design.design.name}</strong></p>
                            <p style="font-size: 0.95rem;">${design.design.purpose.substring(0, 150)}${design.design.purpose.length > 150 ? '...' : ''}</p>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="gallery-item" style="opacity: 0.5;">
                            <h4>${doc.title}</h4>
                            <div class="student-name">No submissions yet</div>
                            <div style="padding: 3rem; background: #f5f5f5; text-align: center; border-radius: 4px;">
                                Waiting for designs...
                            </div>
                        </div>
                    `;
                }
            });
            
            galleryGrid.innerHTML = html;
        }

        function handleReflection(e) {
            e.preventDefault();
            appState.reflectionAnswers = {
                r1: document.getElementById('r1').value,
                r2: document.getElementById('r2').value,
                r3: document.getElementById('r3').value,
                r4: document.getElementById('r4').value,
                r5: document.getElementById('r5').value
            };
            
            // Submit to "database"
            submitFinalWork();
            
            document.getElementById('reflectionForm').classList.add('hidden');
            document.getElementById('completionMessage').classList.remove('hidden');
            
            // Clear saved state
            localStorage.removeItem('enlightenmentJailState');
        }

        function submitFinalWork() {
            const submissions = JSON.parse(localStorage.getItem('enlightenmentJailSubmissions') || '[]');
            submissions.push({
                ...appState,
                completedAt: new Date().toISOString()
            });
            localStorage.setItem('enlightenmentJailSubmissions', JSON.stringify(submissions));
            
            console.log('Final submission:', appState);
            // In production, this would POST to your server
        }

        function goToPhase(phaseNum) {
            appState.currentPhase = phaseNum;
            
            // Hide all phases
            document.querySelectorAll('.phase-content').forEach(el => el.classList.add('hidden'));
            
            // Show current phase
            document.getElementById(`phase${phaseNum}`).classList.remove('hidden');
            
            // Update progress bar
            document.querySelectorAll('.phase').forEach((el, index) => {
                const phase = index + 1;
                el.classList.remove('active', 'completed');
                if (phase < phaseNum) {
                    el.classList.add('completed');
                } else if (phase === phaseNum) {
                    el.classList.add('active');
                }
            });
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            saveState();
        }

        function saveState() {
            localStorage.setItem('enlightenmentJailState', JSON.stringify(appState));
        }

        // ========== ADMIN FUNCTIONS ==========
        
        function enterAdminMode() {
            const password = prompt('Enter instructor password:');
            if (password === 'enlightenment2025') { // Change this password!
                isAdminMode = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('progressBar').classList.add('hidden');
                document.getElementById('phase1').classList.add('hidden');
                loadRosterTable();
            } else if (password !== null) {
                alert('Incorrect password');
            }
        }

        function exitAdminMode() {
            isAdminMode = false;
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('progressBar').classList.remove('hidden');
            document.getElementById('phase1').classList.remove('hidden');
        }

        function addStudent() {
            const id = document.getElementById('newStudentId').value.trim();
            const name = document.getElementById('newStudentName').value.trim();
            const documentId = document.getElementById('newStudentDoc').value;
            
            if (!id || !name || !documentId) {
                alert('Please fill in all fields');
                return;
            }
            
            const roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            
            // Check for duplicate ID
            if (roster.find(s => s.id.toLowerCase() === id.toLowerCase())) {
                alert('A student with this ID already exists');
                return;
            }
            
            roster.push({ id, name, documentId });
            localStorage.setItem('enlightenmentJailRoster', JSON.stringify(roster));
            
            // Clear form
            document.getElementById('newStudentId').value = '';
            document.getElementById('newStudentName').value = '';
            document.getElementById('newStudentDoc').value = '';
            
            loadRosterTable();
        }

        function bulkUpload() {
            const text = document.getElementById('bulkStudents').value.trim();
            if (!text) return;
            
            const roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            const lines = text.split('\n');
            let added = 0;
            let errors = [];
            
            lines.forEach((line, index) => {
                const parts = line.split(',').map(p => p.trim());
                if (parts.length !== 3) {
                    errors.push(`Line ${index + 1}: Invalid format`);
                    return;
                }
                
                const [id, name, documentId] = parts;
                
                // Validate document ID
                if (!documents.find(d => d.id === documentId)) {
                    errors.push(`Line ${index + 1}: Invalid document ID "${documentId}"`);
                    return;
                }
                
                // Check for duplicate
                if (roster.find(s => s.id.toLowerCase() === id.toLowerCase())) {
                    errors.push(`Line ${index + 1}: Duplicate ID "${id}"`);
                    return;
                }
                
                roster.push({ id, name, documentId });
                added++;
            });
            
            localStorage.setItem('enlightenmentJailRoster', JSON.stringify(roster));
            
            if (errors.length > 0) {
                alert(`Added ${added} students.\n\nErrors:\n${errors.join('\n')}`);
            } else {
                alert(`Successfully added ${added} students!`);
            }
            
            document.getElementById('bulkStudents').value = '';
            loadRosterTable();
        }

        function removeStudent(id) {
            if (!confirm(`Remove student ${id}?`)) return;
            
            let roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            roster = roster.filter(s => s.id !== id);
            localStorage.setItem('enlightenmentJailRoster', JSON.stringify(roster));
            loadRosterTable();
        }

        function loadRosterTable() {
            const roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            const tbody = document.getElementById('rosterTable');
            document.getElementById('rosterCount').textContent = roster.length;
            
            if (roster.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: #999;">No students added yet</td></tr>';
                return;
            }
            
            // Sort by document, then by name
            roster.sort((a, b) => {
                if (a.documentId !== b.documentId) {
                    return a.documentId.localeCompare(b.documentId);
                }
                return a.name.localeCompare(b.name);
            });
            
            tbody.innerHTML = roster.map(student => {
                const doc = documents.find(d => d.id === student.documentId);
                return `
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 0.75rem; font-family: monospace;">${student.id}</td>
                        <td style="padding: 0.75rem;">${student.name}</td>
                        <td style="padding: 0.75rem; color: var(--sepia);">${doc ? doc.title : 'Unknown'}</td>
                        <td style="padding: 0.75rem; text-align: center;">
                            <button onclick="removeStudent('${student.id}')" style="background: none; border: none; color: var(--ancient-red); cursor: pointer; font-size: 1.2rem;" title="Remove">‚úï</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function downloadRoster() {
            const roster = JSON.parse(localStorage.getItem('enlightenmentJailRoster') || '[]');
            if (roster.length === 0) {
                alert('No students to download');
                return;
            }
            
            // Create CSV
            let csv = 'Student ID,Name,Document ID,Document Title\n';
            roster.forEach(student => {
                const doc = documents.find(d => d.id === student.documentId);
                csv += `${student.id},${student.name},${student.documentId},"${doc ? doc.title : 'Unknown'}"\n`;
            });
            
            // Download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'enlightenment-jail-roster.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function clearRoster() {
            if (!confirm('Are you sure you want to clear ALL students? This cannot be undone.')) return;
            if (!confirm('Really clear the entire roster? This will delete all student assignments.')) return;
            
            localStorage.removeItem('enlightenmentJailRoster');
            loadRosterTable();
        }
    </script>
</body>
</html>
